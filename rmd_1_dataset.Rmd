---
title: "PCA con EDA y GGPLOT2"
author: "Maestría en Ciencia de Datos"
date: "2024-04-19"
output: html_document
---



```{r}

# Cargar el paquete ggplot2
library(ggplot2)
```


# Lee el dataset
datos <- read.csv("/home/eduardo/R/PCA/violencia_diresav02.csv")

# Muestra las primeras filas del dataset
head(datos)

# Se revisa el dataset
resumen_estadistico <- summary(datos)

# Crea un histograma de la columna Periodo
hist(datos$PERIODO, 
     main = "Histograma de IPRESS",
     xlab = "Periodo",
     ylab = "Frecuencia")
     


# Crea un histograma para la Cantidad de Victimas del Sexo Femenino
hist(datos$F_VIO, main = "Histograma de f_vio", xlab = "F_VIO", col = "blue")

 
# Crea un histograma para la Cantidad de Victimas del Sexo Masculino
hist(datos$M_VIO, main = "Histograma de M_vio", xlab = "M_VIO", col = "blue")


## Barras
```{r}
# Crear un gráfico de barras
library(dplyr)
library(RColorBrewer)

nprov <- datos %>% group_by(PROVINCIA) %>% count()

ggplot(nprov, aes(x = PROVINCIA, y = n)) + 
  geom_bar(stat = "identity") +
  labs(x = "PROVINCIA", y = "Cantidad")



# Una serie básica
ggplot(datos, aes(x=F_VIO, y=PROVINCIA)) + 
  geom_line(color = 'darkblue') + 
  theme_bw() + 
  labs(title = 'Datos de violencia al sexo Femenino', x = 'Casos de Violencia al Sexo Femenino', y = 'Provincia')


# Con títulos y colores diferenciados
ggplot(datos, aes(x=F_VIO, y=PROVINCIA)) + 
  geom_bar(stat="identity") + 
  theme_bw() + 
  coord_flip() +
  labs(title = 'Datos de violencia al sexo Femenino', x = 'Casos de Violencia al Sexo Femenino', y = 'Provincia')

ggplot(datos, aes(x=F_VIO, y=PROVINCIA)) + 
  coord_flip() +
  geom_point()





# Rango de edades en donde el sexo femenino ha sido victima de mayores casos de violencia 


#Calcular rangos de edades
datos_edades_general <- datos %>%
  mutate(Rango_Edades = case_when(
    !is.na(X5_VIO) ~ "5-10",
    !is.na(X6_11_VIO) ~ "11-14",
    !is.na(X12_14_VIO) ~ "12-14",
    !is.na(X15_17_VIO) ~ "15-17",
    !is.na(X18_29_VIO) ~ "18-29",
    !is.na(X30_59_VIO) ~ "30-59",
    !is.na(X60_VIO) ~ "60+",
    TRUE ~ "Desconocido"
  )) %>%
  group_by(Rango_Edades)  %>%
  select(Rango_Edades, F_VIO, M_VIO, VIO_PSICO, VIO_FISI, VIO_SEX,PROVINCIA,DISTRITO)

# Combinar las columnas de rango de edades en una sola columna
datos_edades<- datos %>%
  mutate(Rango_Edades = case_when(
    !is.na(X5_VIO) ~ "5-10",
    !is.na(X6_11_VIO) ~ "11-14",
    !is.na(X12_14_VIO) ~ "12-14",
    !is.na(X15_17_VIO) ~ "15-17",
    !is.na(X18_29_VIO) ~ "18-29",
    !is.na(X30_59_VIO) ~ "30-59",
    !is.na(X60_VIO) ~ "60+",
    TRUE ~ "Desconocido"
  )) %>%
  select(Rango_Edades, F_VIO, M_VIO, VIO_PSICO, VIO_FISI, VIO_SEX,PROVINCIA,DISTRITO)


datos_edades_provincia <- datos %>%
  mutate(Rango_Edades = case_when(
    !is.na(X5_VIO) ~ "5-10",
    !is.na(X6_11_VIO) ~ "11-14",
    !is.na(X12_14_VIO) ~ "12-14",
    !is.na(X15_17_VIO) ~ "15-17",
    !is.na(X18_29_VIO) ~ "18-29",
    !is.na(X30_59_VIO) ~ "30-59",
    !is.na(X60_VIO) ~ "60+",
    TRUE ~ "Desconocido"
  )) %>%
  group_by(Rango_Edades, PROVINCIA) %>%
  summarise(Total_Violencia = sum(F_VIO + M_VIO))

datos_edades_distrito <- datos %>%
  mutate(Rango_Edades = case_when(
    !is.na(X5_VIO) ~ "5-10",
    !is.na(X6_11_VIO) ~ "11-14",
    !is.na(X12_14_VIO) ~ "12-14",
    !is.na(X15_17_VIO) ~ "15-17",
    !is.na(X18_29_VIO) ~ "18-29",
    !is.na(X30_59_VIO) ~ "30-59",
    !is.na(X60_VIO) ~ "60+",
    TRUE ~ "Desconocido"
  )) %>%
  group_by(Rango_Edades, DISTRITO) %>%
  summarise(Total_Violencia = sum(F_VIO + M_VIO))


#Grafico de grupo que mas violencia ha sufrido y su provincia
ggplot(datos_edades_provincia, aes(x = Rango_Edades, y = Total_Violencia, fill = PROVINCIA)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Rango de Edades", y = "Total de Violencia", title = "Total de Violencia por Rango de Edades y Provincia") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Grafico de grupo que mas violencia ha sufrido y su Distrito
ggplot(datos_edades_distrito, aes(x = Rango_Edades, y = Total_Violencia, fill = DISTRITO)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Rango de Edades", y = "Total de Violencia", title = "Total de Violencia por Rango de Edades y Provincia") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Barras horizontales para revisar distritos con mas casos de violencia
colores <- colorRampPalette(c("lightblue", "red"))(length(unique(datos_edades_distrito$Total_Violencia)))
umbral <- quantile(datos_edades_distrito$Total_Violencia, probs = 0.75)
datos_edades_distrito_filtrados <- subset(datos_edades_distrito, Total_Violencia >= umbral)

ggplot(datos_edades_distrito_filtrados, aes(x = DISTRITO, y = Total_Violencia, fill = Total_Violencia)) + 
  geom_bar(stat = "identity") +
  coord_flip() + 
  labs(x = "Distrito", y = "Total de Violencia", title = "Total de Violencia por Distrito") +
  scale_fill_gradientn(colours = colores, limits = c(umbral, max(datos_edades_distrito$Total_Violencia))) + 
  theme(axis.text.y = element_text(size = 8, hjust = 0.5, margin = margin(0, 0, 10, 0, "pt"))) +
  theme(plot.margin = margin(10, 10, 30, 10, "pt"))


```





     
     